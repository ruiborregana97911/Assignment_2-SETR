<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Assignment 2 - SETR: src/cmdproc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Assignment 2 - SETR
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">cmdproc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Implementation of the UART command processing module.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &quot;<a class="el" href="cmdproc_8h_source.html">cmdproc.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sensores_8h_source.html">sensores.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for cmdproc.c:</div>
<div class="dyncontent">
<div class="center"><img src="cmdproc_8c__incl.png" border="0" usemap="#asrc_2cmdproc_8c" alt=""/></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a49d1cfe23d2ad0ab47291c6be7d036b1"><td class="memItemLeft" align="right" valign="top"><a id="a49d1cfe23d2ad0ab47291c6be7d036b1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>clearSensorHistory</b> (void)</td></tr>
<tr class="separator:a49d1cfe23d2ad0ab47291c6be7d036b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbdfe0465dfd34a5f244fe41fa27c12a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#afbdfe0465dfd34a5f244fe41fa27c12a">cmdProcessor</a> (void)</td></tr>
<tr class="memdesc:afbdfe0465dfd34a5f244fe41fa27c12a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes the chars in the RX buffer looking for commands.  <a href="cmdproc_8c.html#afbdfe0465dfd34a5f244fe41fa27c12a">More...</a><br /></td></tr>
<tr class="separator:afbdfe0465dfd34a5f244fe41fa27c12a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ef65a4b93c10be27ff93d891dbe0193"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#a0ef65a4b93c10be27ff93d891dbe0193">calcChecksum</a> (unsigned char *buf, int nbytes)</td></tr>
<tr class="memdesc:a0ef65a4b93c10be27ff93d891dbe0193"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes a modulo-256 checksum of a data buffer.  <a href="cmdproc_8c.html#a0ef65a4b93c10be27ff93d891dbe0193">More...</a><br /></td></tr>
<tr class="separator:a0ef65a4b93c10be27ff93d891dbe0193"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67ae8a79a708a3c5471668bddbd16400"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#a67ae8a79a708a3c5471668bddbd16400">rxChar</a> (unsigned char car)</td></tr>
<tr class="memdesc:a67ae8a79a708a3c5471668bddbd16400"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a character to the UART RX buffer.  <a href="cmdproc_8c.html#a67ae8a79a708a3c5471668bddbd16400">More...</a><br /></td></tr>
<tr class="separator:a67ae8a79a708a3c5471668bddbd16400"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abdb4363f0662688850bbcdfb59ce4566"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#abdb4363f0662688850bbcdfb59ce4566">txChar</a> (unsigned char car)</td></tr>
<tr class="memdesc:abdb4363f0662688850bbcdfb59ce4566"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a character to the UART TX buffer.  <a href="cmdproc_8c.html#abdb4363f0662688850bbcdfb59ce4566">More...</a><br /></td></tr>
<tr class="separator:abdb4363f0662688850bbcdfb59ce4566"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a918f38a7eecdd03671d28a3a07f94856"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#a918f38a7eecdd03671d28a3a07f94856">resetRxBuffer</a> (void)</td></tr>
<tr class="memdesc:a918f38a7eecdd03671d28a3a07f94856"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears the UART RX buffer.  <a href="cmdproc_8c.html#a918f38a7eecdd03671d28a3a07f94856">More...</a><br /></td></tr>
<tr class="separator:a918f38a7eecdd03671d28a3a07f94856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd91ad9b5887f4769f45823899583bab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#abd91ad9b5887f4769f45823899583bab">resetTxBuffer</a> (void)</td></tr>
<tr class="memdesc:abd91ad9b5887f4769f45823899583bab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears the UART TX buffer.  <a href="cmdproc_8c.html#abd91ad9b5887f4769f45823899583bab">More...</a><br /></td></tr>
<tr class="separator:abd91ad9b5887f4769f45823899583bab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae6c75dafeeb8601334ce3cbe089987dd"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#ae6c75dafeeb8601334ce3cbe089987dd">UARTRxBuffer</a> [<a class="el" href="cmdproc_8h.html#a7e4912ef6d5612f8ebca463ff206d9ce">UART_RX_SIZE</a>]</td></tr>
<tr class="memdesc:ae6c75dafeeb8601334ce3cbe089987dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">UART receive buffer.  <a href="cmdproc_8c.html#ae6c75dafeeb8601334ce3cbe089987dd">More...</a><br /></td></tr>
<tr class="separator:ae6c75dafeeb8601334ce3cbe089987dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7801926b7e176ac7223f324794874a2b"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cmdproc_8c.html#a7801926b7e176ac7223f324794874a2b">UARTTxBuffer</a> [<a class="el" href="cmdproc_8h.html#a7bd31e3844f5461db2cbe6d906ca4040">UART_TX_SIZE</a>]</td></tr>
<tr class="memdesc:a7801926b7e176ac7223f324794874a2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">UART transmit buffer.  <a href="cmdproc_8c.html#a7801926b7e176ac7223f324794874a2b">More...</a><br /></td></tr>
<tr class="separator:a7801926b7e176ac7223f324794874a2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of the UART command processing module. </p>
<p>This file contains the implementation of the functions responsible for processing commands received via UART. It includes parsing of command frames, checksum validation, and generation of appropriate responses to the TX buffer.</p>
<p>The supported commands allow reading values from different sensors such as temperature, humidity, and CO2, either individually or all at once.</p>
<dl class="section author"><dt>Authors</dt><dd>Henrique Ferreira <br  />
 Rui Borregana</dd></dl>
<dl class="section date"><dt>Date</dt><dd>5 Apr 2025 </dd></dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>None known.</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="cmdproc_8h.html" title="Header file for UART communication and command processing functions.">cmdproc.h</a> </dd>
<dd>
<a class="el" href="sensores_8c.html" title="Implementation of sensor simulation functions.">sensores.c</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0ef65a4b93c10be27ff93d891dbe0193"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ef65a4b93c10be27ff93d891dbe0193">&#9670;&nbsp;</a></span>calcChecksum()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char calcChecksum </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nbytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes a modulo-256 checksum of a data buffer. </p>
<p>Used to validate the integrity of command frames.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>Pointer to the buffer to compute the checksum from. </td></tr>
    <tr><td class="paramname">nbytes</td><td>Number of bytes to consider for the checksum. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The resulting checksum value. </dd></dl>

</div>
</div>
<a id="afbdfe0465dfd34a5f244fe41fa27c12a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbdfe0465dfd34a5f244fe41fa27c12a">&#9670;&nbsp;</a></span>cmdProcessor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cmdProcessor </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes the chars in the RX buffer looking for commands. </p>
<p>Parses and validates command frames from the RX buffer, then executes the appropriate response.</p>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 : Valid command executed successfully <br  />
</li>
<li>-1 : Empty or incomplete command <br  />
</li>
<li>-2 : Invalid format (missing start/end symbols) <br  />
</li>
<li>-3 : Checksum mismatch <br  />
</li>
<li>-4 : Unknown command </li>
</ul>
</dd></dl>

</div>
</div>
<a id="a918f38a7eecdd03671d28a3a07f94856"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a918f38a7eecdd03671d28a3a07f94856">&#9670;&nbsp;</a></span>resetRxBuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void resetRxBuffer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clears the UART RX buffer. </p>
<p>Resets all values in the receive buffer to 0. </p>

</div>
</div>
<a id="abd91ad9b5887f4769f45823899583bab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd91ad9b5887f4769f45823899583bab">&#9670;&nbsp;</a></span>resetTxBuffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void resetTxBuffer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clears the UART TX buffer. </p>
<p>Resets all values in the transmit buffer to 0. </p>

</div>
</div>
<a id="a67ae8a79a708a3c5471668bddbd16400"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67ae8a79a708a3c5471668bddbd16400">&#9670;&nbsp;</a></span>rxChar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rxChar </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>car</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a character to the UART RX buffer. </p>
<p>Simulates receiving a character through UART and stores it in the receive buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">car</td><td>Character to be added to the buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 : Success <br  />
</li>
<li>-1 : Buffer overflow </li>
</ul>
</dd></dl>

</div>
</div>
<a id="abdb4363f0662688850bbcdfb59ce4566"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdb4363f0662688850bbcdfb59ce4566">&#9670;&nbsp;</a></span>txChar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int txChar </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>car</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a character to the UART TX buffer. </p>
<p>Simulates transmitting a character through UART and stores it in the transmit buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">car</td><td>Character to be added to the buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>0 : Success <br  />
</li>
<li>-1 : Buffer overflow </li>
</ul>
</dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ae6c75dafeeb8601334ce3cbe089987dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6c75dafeeb8601334ce3cbe089987dd">&#9670;&nbsp;</a></span>UARTRxBuffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char UARTRxBuffer[<a class="el" href="cmdproc_8h.html#a7e4912ef6d5612f8ebca463ff206d9ce">UART_RX_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UART receive buffer. </p>
<p>Stores incoming characters received via UART. </p>

</div>
</div>
<a id="a7801926b7e176ac7223f324794874a2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7801926b7e176ac7223f324794874a2b">&#9670;&nbsp;</a></span>UARTTxBuffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char UARTTxBuffer[<a class="el" href="cmdproc_8h.html#a7bd31e3844f5461db2cbe6d906ca4040">UART_TX_SIZE</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>UART transmit buffer. </p>
<p>Stores outgoing characters to be transmitted via UART. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
